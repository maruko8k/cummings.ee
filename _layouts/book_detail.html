{% extends 'base.html' %}

{% set meta = book %}

{% block content %}
<nav class="nav">
  <p><a href="/">e.e. cummings free poetry archive</a></p>
  <div class="break small"></div>
</nav>
<header class="book">
  <h1>{{ book.title }}</h1>
</header>
<section name="intro" class="intro">
  <p>
    {{ book.description }}
    {% if book.public_domain == 'false' %}Until then, it remains protected by copyright and cannot be republished here.{% endif %}
  </p>
</section>
{% if book.public_domain == 'true' %}
<section name="toc" class="toc">
  <h2>Table of contents</h2>
  <ul class="level1">
  {% for level1 in toc[book.slug] %}
    <li>{{ level1.name }}</li>
    <ul class="level2">
    {% for level2 in level1.children %}
      <li>
      {% if level2.children %}
        {{ level2.name }} ({% for level3 in level2.children %}{% if poems[book.slug][level3.slug] %}<a href="/book/{{ book.slug }}/poem/{{ level3.slug }}/">{{ level3.name }}</a>{% else %}{{ level3.name }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %})
      {% else %}
        {% if poems[book.slug][level2.slug] %}
          <a href="/book/{{ book.slug }}/poem/{{ level2.slug }}/">{{ level2.name }}</a>
        {% else %}
          {{ level2.name }}
        {% endif %}
      {% endif %}
      </li>
    {% endfor %}
    </ul>
  {% endfor %}
  </ul>
</section>
{% endif %}
{% endblock content %}
